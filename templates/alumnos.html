<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva Habitación</title>

    <!-- Agregar librerías de Pusher y jQuery -->
    <script src="https://js.pusher.com/7.2/pusher.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Reservaciones</h1>

    <form id="form-reserva">
        <input type="hidden" id="id_reserva" name="id_reserva">
        <label for="nombre_completo">Nombre y Apellido:</label>
        <input type="text" id="nombre_completo" name="nombre_completo" required>
        <br>
        <label for="telefono">Teléfono:</label>
        <input type="text" id="telefono" name="telefono" required>
        <br>
        <label for="fecha">Fecha de reserva:</label>
        <input type="date" id="fecha" name="fecha" required>
        <br>
        <button type="submit">Reservar</button>
    </form>

    <h2>Lista de Reservaciones</h2>
    <ul id="lista-reservas"></ul>

    <script>
        $(document).ready(function() {
            // Función para cargar la lista de reservaciones
            function cargarReservas() {
                $.ajax({
                    url: '/reservas',
                    method: 'GET',
                    success: function(reservas) {
                        let lista = $('#lista-reservas');
                        lista.empty();  // Limpiar la lista
                        reservas.forEach(function(reserva) {
                            lista.append(`<li>${reserva.Nombre_Completo} - ${reserva.Telefono} - ${reserva.Fecha}</li>`);
                        });
                    }
                });
            }

            // Llamar a la función para cargar las reservas al cargar la página
            cargarReservas();

            // Enviar el formulario de reserva
            $('#form-reserva').on('submit', function(event) {
                event.preventDefault();
                let datos = $(this).serialize();
                $.ajax({
                    url: '/reservas/guardar',
                    method: 'POST',
                    data: datos,
                    success: function(response) {
                        alert(response.message);
                        $('#form-reserva')[0].reset();  // Limpiar el formulario
                        cargarReservas();  // Recargar las reservas
                    }
                });
            });

            // Configurar Pusher
            const pusher = new Pusher('73801e00502db5454777', {
                cluster: 'us2',
                encrypted: true
            });

            // Suscribirse al canal y escuchar el evento de actualización
            const canal = pusher.subscribe('canalReservas');
            canal.bind('actualizacion', function(data) {
                alert('La lista de reservaciones ha sido actualizada');
                cargarReservas();  // Recargar las reservas cuando haya una actualización
            });
        });
    </script>
</body>
</html>
